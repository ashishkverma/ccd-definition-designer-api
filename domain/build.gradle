// until https://github.com/gradle/gradle/issues/867 is 'resolved'
// see also https://github.com/nebula-plugins/gradle-extra-configurations-plugin
plugins {
    id 'nebula.optional-base' version '3.3.0'
    id 'nebula.provided-base' version '3.3.0'
    id 'net.ltgt.apt' version '0.18'
}

apply plugin: 'nebula.optional-base'

// Create JAR with test fixtures
task testJar(type: Jar, dependsOn: testClasses) {
    baseName = 'test-${project.archivesBaseName}'
    classifier = 'tests'
    from sourceSets.test.output
}

artifacts {
    archives testJar
}

configurations {
    testOutput.extendsFrom (testCompile)
}

jar {
    baseName = 'definition-store-domain'
}

ext {
    mapstructGenSourceDir = 'build/classes/java/main'
    orgMapstructVersion='1.2.0.Final'
}

dependencies {
    compile project(':app-insights')
    compile (project(':repository')) {
        exclude group: 'org.mapstruct', module: 'mapstruct'
    }
    compile "org.apache.commons:commons-lang3"
    compile group: 'commons-validator', name: 'commons-validator', version: '1.6'
    compile "org.mapstruct:mapstruct-jdk8:${orgMapstructVersion}"
    // Adding mapstruct-processor as an optional dependancy required pending resolution of
    // https://youtrack.jetbrains.com/issue/IDEA-150621
    // See http://mapstruct.org/documentation/ide-support/
    compile "org.mapstruct:mapstruct-processor:${orgMapstructVersion}", optional
    testCompile project(":app-insights").sourceSets.main.output

    apt "org.mapstruct:mapstruct-processor:${orgMapstructVersion}"
}

idea {
    module {
        sourceDirs += file('${mapstructGenSourceDir}')
        generatedSourceDirs += file('${mapstructGenSourceDir}')
    }
}
